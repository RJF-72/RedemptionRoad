<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOTA Script-to-Video Engine - AI-Powered Video Generation from Scripts</title>
    <script src="config.js"></script>
    <script src="voice.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: radial-gradient(1200px 600px at 10% 10%, rgba(0,255,255,0.08), transparent 60%),
                        radial-gradient(1200px 600px at 90% 0%, rgba(255,0,128,0.08), transparent 60%),
                        radial-gradient(1000px 600px at 50% 100%, rgba(0,255,200,0.06), transparent 60%),
                        #0b1220;
            color: #E6F3FF;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* üé¨ HEADER */
        .header {
            background: linear-gradient(135deg, rgba(0,212,255,0.12) 0%, rgba(255,0,128,0.12) 100%);
            backdrop-filter: blur(18px);
            padding: 20px;
            border-bottom: 1px solid rgba(0,212,255,0.25);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .sota-logo {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(45deg, #00E5FF, #15B7FF, #FF1BB3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0,212,255,0.45);
        }
        
        .header-stats {
            display: flex;
            gap: 30px;
            font-size: 14px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px 15px;
            background: rgba(0,212,255,0.08);
            border-radius: 10px;
            border: 1px solid rgba(0,212,255,0.28);
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #00E5FF;
        }
        
        /* üéõÔ∏è MAIN INTERFACE */
        .main-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 400px 1fr 350px;
            gap: 20px;
            min-height: calc(100vh - 120px);
        }
        
        /* üìù LEFT PANEL - SCRIPT INPUT */
        .script-input-panel {
            background: linear-gradient(135deg, rgba(0,212,255,0.05) 0%, rgba(255,0,128,0.05) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0,212,255,0.2);
            border-radius: 20px;
            padding: 25px;
            height: fit-content;
        }
        
        .panel-title {
            font-size: 20px;
            font-weight: 700;
            color: #00E5FF;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px rgba(0,212,255,0.45);
        }
        
        .script-type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .script-type {
            background: rgba(0,212,255,0.08);
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        
        .script-type:hover {
            background: rgba(0,212,255,0.18);
            border-color: #00E5FF;
        }
        
        .script-type.active {
            background: linear-gradient(135deg, #FF1BB3, #8B5CF6);
            color: #000814;
            font-weight: 700;
        }
        
        .script-editor {
            background: rgba(1,8,20,0.5);
            border: 1px solid rgba(0,212,255,0.28);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .script-textarea {
            width: 100%;
            height: 400px;
            background: rgba(1,8,20,0.65);
            border: 1px solid rgba(0,212,255,0.2);
            border-radius: 10px;
            padding: 15px;
            color: #E6F3FF;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
        }
        
        .script-textarea:focus {
            outline: none;
            border-color: #00E5FF;
            box-shadow: 0 0 18px rgba(0,212,255,0.28);
        }
        
        .script-templates {
            background: rgba(1,8,20,0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .template-item {
            background: rgba(0,212,255,0.08);
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        
        .template-item:hover {
            background: rgba(0,212,255,0.18);
            border-color: #00E5FF;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 5px;
            color: #00E5FF;
            font-weight: 600;
        }
        
        .sota-input, .sota-select {
            width: 100%;
            padding: 12px;
            background: rgba(1,8,20,0.5);
            border: 1px solid rgba(0,212,255,0.28);
            border-radius: 10px;
            color: #E6F3FF;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
        }
        
        .sota-input:focus, .sota-select:focus {
            outline: none;
            border-color: #00E5FF;
            box-shadow: 0 0 18px rgba(0,212,255,0.28);
        }
        
        /* üé¨ CENTER PANEL - VIDEO GENERATION */
        .video-generation-panel {
            background: linear-gradient(135deg, rgba(0,212,255,0.04) 0%, rgba(255,0,128,0.04) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0,212,255,0.2);
            border-radius: 20px;
            padding: 25px;
        }
        
        .generation-progress {
            background: rgba(1,8,20,0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .stage-indicator {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stage-item {
            background: rgba(0,212,255,0.08);
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .stage-item.active {
            background: linear-gradient(135deg, #FF1BB3, #8B5CF6);
            color: #000814;
            font-weight: 700;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .stage-item.completed {
            background: linear-gradient(135deg, #00E5FF, #15B7FF);
            color: #001019;
            font-weight: 700;
        }
        
        .video-preview {
            background: rgba(1,8,20,0.55);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0,212,255,0.22);
        }
        
        .preview-placeholder {
            text-align: center;
            color: rgba(0,212,255,0.7);
        }
        
        .preview-video {
            width: 100%;
            max-height: 400px;
            border-radius: 15px;
        }
        
        .scene-timeline {
            background: rgba(1,8,20,0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .timeline-controls {
            display: flex;
            gap: 10px;
        }
        
        .timeline-btn {
            background: rgba(0,212,255,0.14);
            border: 1px solid rgba(0,212,255,0.45);
            border-radius: 5px;
            padding: 5px 10px;
            color: #00E5FF;
            cursor: pointer;
            font-size: 12px;
        }
        
        .timeline-btn:hover {
            background: #00E5FF;
            color: #001019;
        }
        
        .scene-list {
            max-height: 250px;
            overflow-y: auto;
        }
        
        .scene-item {
            background: rgba(0,212,255,0.08);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .scene-preview {
            width: 60px;
            height: 40px;
            background: rgba(0,212,255,0.16);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .scene-info {
            flex: 1;
            margin-left: 15px;
        }
        
        .scene-time {
            font-weight: 600;
            color: #00E5FF;
            font-size: 12px;
        }
        
        .scene-description {
            font-size: 11px;
            color: rgba(255,255,255,0.8);
            margin-top: 2px;
        }
        
        .scene-controls {
            display: flex;
            gap: 5px;
        }
        
        .scene-btn {
            background: rgba(0,212,255,0.14);
            border: 1px solid rgba(0,212,255,0.45);
            border-radius: 5px;
            padding: 5px 8px;
            color: #00E5FF;
            cursor: pointer;
            font-size: 10px;
        }
        
        .scene-btn:hover {
            background: #00E5FF;
            color: #001019;
        }
        
        .generation-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .sota-button {
            background: linear-gradient(135deg, #00E5FF 0%, #15B7FF 100%);
            color: #001019;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .sota-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,212,255,0.35);
        }
        
        .sota-button.secondary {
            background: transparent;
            color: #00E5FF;
            border: 1px solid #00E5FF;
        }
        
        .sota-button.secondary:hover {
            background: #00E5FF;
            color: #001019;
        }
        
        /* üé® RIGHT PANEL - AI SETTINGS */
        .ai-settings-panel {
            background: linear-gradient(135deg, rgba(0,212,255,0.05) 0%, rgba(255,0,128,0.05) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0,212,255,0.2);
            border-radius: 20px;
            padding: 25px;
            height: fit-content;
        }
        
        .ai-models-section {
            background: rgba(1,8,20,0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,212,255,0.12);
        }
        
        .model-item:last-child {
            border-bottom: none;
        }
        
        .model-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00E5FF;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .style-section {
            margin-bottom: 20px;
        }
        
        .style-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .style-option {
            background: rgba(0,212,255,0.08);
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
        }
        
        .style-option:hover {
            background: rgba(0,212,255,0.18);
            border-color: #00E5FF;
        }
        
        .style-option.active {
            background: linear-gradient(135deg, #FF1BB3, #8B5CF6);
            color: #000814;
            font-weight: 700;
        }
        
        .export-section {
            background: rgba(1,8,20,0.5);
            border-radius: 15px;
            padding: 20px;
        }
        
        .export-format {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,212,255,0.12);
            font-size: 12px;
        }
        
        .export-format:last-child {
            border-bottom: none;
        }
        
        .quality-slider {
            width: 100%;
            margin: 15px 0;
        }
        
        /* üé≠ PROGRESS ANIMATION */
        .progress-container {
            background: rgba(1,8,20,0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .progress-bar {
            background: rgba(0,212,255,0.16);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #00E5FF, #15B7FF);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .progress-text {
            text-align: center;
            color: #00E5FF;
            font-weight: 600;
            font-size: 14px;
        }
        
        /* üé® ANIMATIONS */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 18px rgba(0,212,255,0.25); }
            50% { box-shadow: 0 0 32px rgba(255,0,128,0.35); }
            100% { box-shadow: 0 0 18px rgba(0,212,255,0.25); }
        }
        
        .generating {
            animation: glow 2s ease-in-out infinite;
        }
        
        /* üì± RESPONSIVE DESIGN */
        @media (max-width: 1400px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stage-indicator {
                grid-template-columns: 1fr;
            }
            
            .style-grid {
                grid-template-columns: 1fr;
            }
        }
        /* ‚úÖ Status bar and toast */
        .status-bar { position: sticky; top: 0; z-index: 1200; margin: 0; padding: 10px 16px; border-bottom: 1px solid rgba(0,212,255,0.25); font-weight: 700; }
        .status-info { background: rgba(0,212,255,0.12); color: #00E5FF; }
        .status-warn { background: rgba(250,204,21,0.12); color: #facc15; }
        .status-error { background: rgba(239,68,68,0.12); color: #f87171; }
        .status-success { background: rgba(34,197,94,0.12); color: #86efac; }
        .toast-container { position: fixed; right: 20px; bottom: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 1500; }
        .toast { background: rgba(0,0,0,0.75); border: 1px solid rgba(0,212,255,0.35); color: #E6F3FF; padding: 10px 14px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 360px; }
        .toast.warn { border-color: rgba(250,204,21,0.45); color: #fde68a; }
        .toast.error { border-color: rgba(248,113,113,0.45); color: #fecaca; }
        .toast.success { border-color: rgba(34,197,94,0.45); color: #bbf7d0; }
    </style>
</head>
<body>
    <div id="statusBar" class="status-bar status-info" style="display:none"></div>
    <!-- üé¨ HEADER -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <a href="index.html" style="text-decoration:none; color:inherit;">
                    <div class="sota-logo">üìù SOTA Script-to-Video Engine</div>
                </a>
                <div style="color: rgba(0,212,255,0.8); font-size: 14px;">
                    AI-Powered Video Generation from Scripts
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value">3,847</div>
                    <div>Scripts Processed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">89.7%</div>
                    <div>Success Rate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">4.2M</div>
                    <div>Scenes Generated</div>
                </div>
            </div>
        </div>
    </header>

    <!-- üéõÔ∏è MAIN INTERFACE -->
    <main class="main-container">
        <!-- üìù LEFT PANEL - SCRIPT INPUT -->
        <section class="script-input-panel">
            <h2 class="panel-title">üìù Script Input & Templates</h2>
            
            <!-- Script Type Selector -->
            <div class="script-type-selector">
                <div class="script-type active" onclick="selectScriptType('narrative', event)">
                    üé≠ Narrative
                </div>
                <div class="script-type" onclick="selectScriptType('commercial', event)">
                    üì∫ Commercial
                </div>
                <div class="script-type" onclick="selectScriptType('educational', event)">
                    üéì Educational
                </div>
                <div class="script-type" onclick="selectScriptType('promotional', event)">
                    üì¢ Promotional
                </div>
            </div>
            
            <!-- Script Editor -->
            <div class="script-editor">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">‚úçÔ∏è Script Editor</h3>
                <textarea 
                    class="script-textarea"
                    id="scriptContent"
                    placeholder="Enter your script here...

Example Format:
[SCENE 1 - 0:00-0:10]
LOCATION: Modern office interior, morning light
CAMERA: Medium shot, slowly zooming in
ACTION: Professional woman enters frame, confident walk
DIALOGUE: 'Innovation starts with a single idea...'
MUSIC: Inspiring, building momentum

[SCENE 2 - 0:10-0:25]
LOCATION: Close-up of hands typing on laptop
CAMERA: Macro lens, shallow depth of field
ACTION: Fast-paced typing, code appearing on screen
MUSIC: Energetic, tech-driven beat

[SCENE 3 - 0:25-0:40]
LOCATION: Wide shot of team collaboration
CAMERA: Drone shot, circling the group
ACTION: Team members pointing at charts, discussing
DIALOGUE: 'Together, we build the future'
MUSIC: Crescendo, triumphant finale

Use clear scene markers, timing, and detailed descriptions for best AI interpretation."></textarea>
            </div>
            
            <!-- Script Templates -->
            <div class="script-templates">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">üìã Quick Templates</h3>
                <div class="template-grid">
                    <div class="template-item" onclick="loadTemplate('product-demo')">
                        üì± Product Demo Script
                    </div>
                    <div class="template-item" onclick="loadTemplate('testimonial')">
                        üí¨ Customer Testimonial
                    </div>
                    <div class="template-item" onclick="loadTemplate('brand-story')">
                        üè¢ Brand Story Script
                    </div>
                    <div class="template-item" onclick="loadTemplate('how-to')">
                        üîß How-To Tutorial
                    </div>
                    <div class="template-item" onclick="loadTemplate('dramatic')">
                        üé≠ Dramatic Scene
                    </div>
                    <div class="template-item" onclick="loadTemplate('comedy')">
                        üòÑ Comedy Sketch
                    </div>
                </div>
            </div>
            
            <!-- Video Settings -->
            <div class="input-group">
                <label class="input-label">‚è±Ô∏è Video Duration</label>
                <select class="sota-select" id="videoDuration">
                    <option value="30">30 seconds</option>
                    <option value="60">1 minute</option>
                    <option value="90">90 seconds</option>
                    <option value="120">2 minutes</option>
                    <option value="180">3 minutes</option>
                    <option value="300">5 minutes</option>
                    <option value="custom">Custom Length</option>
                </select>
            </div>
            
            <div class="input-group">
                <label class="input-label">üé® Visual Style</label>
                <select class="sota-select" id="visualStyle">
                    <option value="cinematic">Cinematic</option>
                    <option value="documentary">Documentary</option>
                    <option value="commercial">Commercial</option>
                    <option value="artistic">Artistic</option>
                    <option value="minimalist">Minimalist</option>
                    <option value="dramatic">Dramatic</option>
                </select>
            </div>
        </section>

        <!-- üé¨ CENTER PANEL - VIDEO GENERATION -->
        <section class="video-generation-panel">
            <h2 class="panel-title">üé¨ AI Video Generation Pipeline</h2>
            
            <!-- Generation Progress Stages -->
            <div class="generation-progress">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">üöÄ Generation Stages</h3>
                <div class="stage-indicator">
                    <div class="stage-item" id="stage1">
                        <div>üîç</div>
                        <div>Script Analysis</div>
                    </div>
                    <div class="stage-item" id="stage2">
                        <div>üé¨</div>
                        <div>Scene Planning</div>
                    </div>
                    <div class="stage-item" id="stage3">
                        <div>üé®</div>
                        <div>Visual Creation</div>
                    </div>
                    <div class="stage-item" id="stage4">
                        <div>üéµ</div>
                        <div>Audio Sync</div>
                    </div>
                    <div class="stage-item" id="stage5">
                        <div>‚ö°</div>
                        <div>Final Render</div>
                    </div>
                </div>
            </div>
            
            <!-- Video Preview Area -->
            <div class="video-preview" id="videoPreview">
                <div class="preview-placeholder">
                    <div style="font-size: 48px; margin-bottom: 20px;">üìù‚û°Ô∏èüé¨</div>
                    <h3>Script-to-Video Generation</h3>
                    <p>Enter your script and watch AI transform it into cinematic video</p>
                </div>
            </div>
            <!-- Transport controls -->
            <div id="transportControls" style="margin-top: 8px; display: grid; grid-template-columns: 120px 1fr 120px 220px; gap: 10px; align-items: center;">
                <div style="display:flex; gap:6px;">
                    <button class="sota-button" id="btnPlayPause" onclick="togglePreviewPlay()">‚ñ∂ Play</button>
                    <button class="sota-button secondary" onclick="stopPreview()">‚èπ Stop</button>
                </div>
                <input type="range" id="previewSeek" min="0" max="100" value="0" step="0.1" />
                <div id="timecode" style="font-variant-numeric: tabular-nums; text-align:center;">00:00.0 / 00:00.0</div>
                <div style="display:flex; gap:8px; align-items:center;">
                    <label class="input-label" style="margin:0;">Loop</label>
                    <input type="checkbox" id="loopEnable" />
                    <label class="input-label" style="margin:0;">In</label>
                    <input type="number" id="loopIn" min="0" value="0" style="width:70px;" />
                    <label class="input-label" style="margin:0;">Out</label>
                    <input type="number" id="loopOut" min="0" value="0" style="width:70px;" />
                </div>
            </div>
            <!-- Real generation controls -->
            <div id="scriptVideoControls" style="margin-top: 10px; display: grid; grid-template-columns: repeat(4, minmax(140px, 1fr)); gap: 10px; align-items: center;">
                <div>
                    <label class="input-label">Optional Audio</label>
                    <input id="scriptAudioInput" type="file" accept="audio/*" />
                </div>
                <div>
                    <label class="input-label">FPS</label>
                    <select id="scriptFps" class="sota-select">
                        <option value="24">24</option>
                        <option value="30" selected>30</option>
                        <option value="60">60</option>
                    </select>
                </div>
                <div>
                    <label class="input-label">Palette</label>
                    <select id="scriptPalette" class="sota-select">
                        <option value="vibrant" selected>Vibrant</option>
                        <option value="warm">Warm</option>
                        <option value="cool">Cool</option>
                        <option value="neon">Neon</option>
                        <option value="mono">Mono</option>
                    </select>
                </div>
                <div style="display:flex; gap: 8px; align-items: end;">
                    <button class="sota-button" onclick="generateFromScript()">Build & Preview</button>
                    <button class="sota-button secondary" onclick="exportVideo()">Export WebM</button>
                </div>
            </div>
            <div id="lyricsControls" style="margin-top: 10px; display: grid; grid-template-columns: repeat(4, minmax(140px, 1fr)); gap: 10px; align-items: center;">
                <div>
                    <label class="input-label">Import Lyrics (LRC/SRT/TXT)</label>
                    <input id="lyricsFile" type="file" accept=".lrc,.srt,.txt" />
                </div>
                <div>
                    <label class="input-label">Show Lyrics</label>
                    <select id="lyricsEnabled" class="sota-select">
                        <option value="on" selected>On</option>
                        <option value="off">Off</option>
                    </select>
                </div>
                <div>
                    <label class="input-label">Font Size</label>
                    <select id="lyricsSize" class="sota-select">
                        <option value="28">28</option>
                        <option value="32">32</option>
                        <option value="36" selected>36</option>
                        <option value="42">42</option>
                        <option value="48">48</option>
                    </select>
                </div>
                <div>
                    <label class="input-label">Style</label>
                    <select id="lyricsStyle" class="sota-select">
                        <option value="karaoke" selected>Karaoke</option>
                        <option value="plain">Plain</option>
                    </select>
                </div>
            </div>
            
            <!-- Progress Indicator -->
            <div class="progress-container" id="progressContainer">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">ü§ñ AI Processing Your Script...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
                <div class="progress-text" id="progressText">Analyzing script structure and narrative flow...</div>
            </div>
            
            <!-- Scene Timeline -->
            <div class="scene-timeline">
                <div class="timeline-header">
                    <h3 style="color: #BA55D3;">üé¨ Generated Scene Timeline</h3>
                    <div class="timeline-controls">
                        <button class="timeline-btn" onclick="addScene()">‚ûï Add Scene</button>
                        <button class="timeline-btn" onclick="reorderScenes()">üîÑ Reorder</button>
                        <button class="timeline-btn" onclick="adjustTiming()">‚è±Ô∏è Timing</button>
                    </div>
                </div>
                <div class="scene-list" id="sceneList">
                    <!-- Scenes will be populated here -->
                </div>
            </div>
            
            <!-- Generation Controls -->
            <div class="generation-controls">
                <button class="sota-button" onclick="generateFromScript()">
                    üöÄ Generate Video
                </button>
                <button class="sota-button secondary" onclick="previewScript()">
                    üëÅÔ∏è Preview Script
                </button>
            </div>
        </section>

        <!-- üé® RIGHT PANEL - AI SETTINGS -->
        <section class="ai-settings-panel">
            <h2 class="panel-title">ü§ñ AI Engine Settings</h2>
            
            <!-- AI Models Status -->
            <div class="ai-models-section">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">üß† AI Models</h3>
                
                <div class="model-item">
                    <div>
                        <div style="font-weight: 600;">Script Analyzer</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.7);">GPT-4 Turbo</div>
                    </div>
                    <div class="model-status"></div>
                </div>
                
                <div class="model-item">
                    <div>
                        <div style="font-weight: 600;">Visual Generator</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.7);">DALL-E 3</div>
                    </div>
                    <div class="model-status"></div>
                </div>
                
                <div class="model-item">
                    <div>
                        <div style="font-weight: 600;">Motion Synthesis</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.7);">RunwayML Gen-2</div>
                    </div>
                    <div class="model-status"></div>
                </div>
                
                <div class="model-item">
                    <div>
                        <div style="font-weight: 600;">Voice Synthesis</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.7);">ElevenLabs</div>
                    </div>
                    <div class="model-status"></div>
                </div>
            </div>
            
            <!-- Generation Style -->
            <div class="style-section">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">üé® Generation Style</h3>
                <div class="style-grid">
                    <div class="style-option active" onclick="selectGenerationStyle('realistic', event)">
                        üì∑ Realistic
                    </div>
                    <div class="style-option" onclick="selectGenerationStyle('animated', event)">
                        üé® Animated
                    </div>
                    <div class="style-option" onclick="selectGenerationStyle('artistic', event)">
                        üñºÔ∏è Artistic
                    </div>
                    <div class="style-option" onclick="selectGenerationStyle('cartoon', event)">
                        üé™ Cartoon
                    </div>
                </div>
            </div>
            
            <!-- Character Settings -->
            <div class="style-section">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">üë• Character Settings</h3>
                <div class="input-group">
                    <label class="input-label">Character Consistency</label>
                    <select class="sota-select">
                        <option value="high">High (Slower)</option>
                        <option value="medium">Medium (Balanced)</option>
                        <option value="low">Low (Faster)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Voice Generation</label>
                    <select class="sota-select">
                        <option value="auto">Auto-Generate</option>
                        <option value="custom">Upload Voice</option>
                        <option value="text-only">Text Only</option>
                    </select>
                </div>
            </div>
            
            <!-- Export Settings -->
            <div class="export-section">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">üíæ Export Settings</h3>
                
                <div class="export-format">
                    <span>üé¨ Format:</span>
                    <select class="sota-select" style="width: 100px; font-size: 11px;">
                        <option value="mp4">MP4</option>
                        <option value="mov">MOV</option>
                        <option value="avi">AVI</option>
                    </select>
                </div>
                
                <div class="export-format">
                    <span>üì∫ Resolution:</span>
                    <select class="sota-select" style="width: 100px; font-size: 11px;">
                        <option value="1080p">1080p</option>
                        <option value="4k">4K</option>
                        <option value="720p">720p</option>
                    </select>
                </div>
                
                <div class="export-format">
                    <span>‚ö° Processing:</span>
                    <span style="color: #BA55D3;">GPU Enabled</span>
                </div>
                
                <div class="export-format">
                    <span>üìä Quality:</span>
                    <span style="color: #BA55D3;">Ultra High</span>
                </div>
                <input type="range" class="quality-slider" min="1" max="10" value="9">
                
                <button class="sota-button" style="width: 100%; margin-top: 20px;" onclick="exportVideo()">
                    üíæ Export Video
                </button>
            </div>
            
            <!-- Quick Actions -->
            <div class="style-section">
                <h3 style="color: #BA55D3; margin-bottom: 15px;">‚ö° Quick Actions</h3>
                <button class="sota-button secondary" style="width: 100%; margin-bottom: 10px;" onclick="saveScript()">
                    üíæ Save Script
                </button>
                <button class="sota-button secondary" style="width: 100%; margin-bottom: 10px;" onclick="loadScript()">
                    üìÅ Load Script
                </button>
                <button class="sota-button secondary" style="width: 100%;" onclick="shareProject()">
                    üì§ Share Project
                </button>
            </div>
        </section>
    </main>
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // üîî Status + toast helpers
        function setStatus(message, type='info', persist=false){
            const bar = document.getElementById('statusBar');
            bar.className = `status-bar status-${type}`; bar.textContent = message; bar.style.display = 'block';
            if (!persist) { clearTimeout(setStatus._t); setStatus._t = setTimeout(()=>{ bar.style.display='none'; }, 4000); }
        }
        function showToast(message, type='info', timeout=4000){
            const cont = document.getElementById('toastContainer');
            const t = document.createElement('div'); t.className = `toast ${type}`; t.textContent = message;
            cont.appendChild(t); setTimeout(()=>{ t.style.opacity='0'; t.style.transition='opacity .3s'; }, timeout-300); setTimeout(()=>t.remove(), timeout);
        }
        // Voice commands for Script-to-Video Engine
        (function(){
            if (!window.SOTAVoice) return;
            SOTAVoice.init({ tts: false });

            const clickByOnclickContains = (substr) => {
                const el = Array.from(document.querySelectorAll('[onclick]')).find(e => (e.getAttribute('onclick')||'').includes(substr));
                if (el) el.click();
            };

            SOTAVoice.registerCommands([
                { pattern: /^(?:play|start) preview$/i, description: 'Play preview', handler: () => { try { const btn=document.getElementById('btnPlayPause'); if(btn&&btn.textContent.includes('Play')) btn.click(); else togglePreviewPlay(); } catch(_){} } },
                { pattern: /^(?:pause|stop) preview$/i, description: 'Pause preview', handler: () => { try { const btn=document.getElementById('btnPlayPause'); if(btn&&btn.textContent.includes('Pause')) btn.click(); else stopPreview(); } catch(_){} } },
                { pattern: /^stop$/i, description: 'Stop preview', handler: () => { try { stopPreview(); } catch(_){} } },
                { pattern: /^(?:build|generate) (?:from )?script$/i, description: 'Build & Preview from script', handler: () => { try { generateFromScript(); } catch(_){} } },
                { pattern: /^export (?:video|webm)$/i, description: 'Export WebM', handler: () => { try { exportVideo(); } catch(_){} } },
                { pattern: /^preview script$/i, description: 'Preview script', handler: () => { try { previewScript(); } catch(_){} } },
                { pattern: /^set duration (15|30|60|90)(?:s| seconds?)?$/i, description: 'Set video duration', handler: (m) => { const sel=document.getElementById('videoDuration'); if(sel){ sel.value=m[1]; sel.dispatchEvent(new Event('change')); } } },
                { pattern: /^set style (realistic|animated|artistic|cartoon)$/i, description: 'Set generation style', handler: (m) => clickByOnclickContains(`selectGenerationStyle('${m[1]}')`) },
                { pattern: /^(?:upload|set) audio$/i, description: 'Upload audio for timing', handler: () => { const inp=document.getElementById('scriptAudioInput'); if(inp) inp.click(); } },
                { pattern: /^(?:upload|load) lyrics$/i, description: 'Upload lyrics file', handler: () => { const inp=document.getElementById('lyricsFile'); if(inp) inp.click(); } },
                { pattern: /^enable lyrics$/i, description: 'Enable lyrics overlay', handler: () => { const sel=document.getElementById('lyricsEnabled'); if(sel){ sel.value='on'; sel.dispatchEvent(new Event('change')); } } },
                { pattern: /^disable lyrics$/i, description: 'Disable lyrics overlay', handler: () => { const sel=document.getElementById('lyricsEnabled'); if(sel){ sel.value='off'; sel.dispatchEvent(new Event('change')); } } },
            ]);
    })();
        // Centralized backend URL (via config.js). Defaults to same-origin for Netlify proxy.
        const BACKEND_URL = (typeof window !== 'undefined' && window.SOTA_BACKEND_URL !== undefined)
            ? window.SOTA_BACKEND_URL
            : '';
        // üìù SOTA Script-to-Video Engine JavaScript
        let currentScriptType = 'narrative';
        let currentGenerationStyle = 'realistic';
        let isGenerating = false;
        let generatedScenes = [];
        // Real script-to-video state
        let scriptScenes = [];
    let scriptPlayback = { playing:false, startTime:0, pauseOffset:0, fps:30, palette:'vibrant', canvas:null, ctx:null, raf:0 };
    let scriptAudio = { ctx:null, buf:null, src:null };
    let recorder = { mr:null, chunks:[], recording:false, downloadUrl:'' };
    // Lyrics state
    let lyrics = []; // {start:sec, end:sec, text}
    let lyricsSettings = { enabled:true, size:36, style:'karaoke' };

        const PALETTES = {
            vibrant:[0,45,200,280], warm:[10,25,35,5], cool:[180,200,220,160], neon:[140,190,300,330], mono:[210,210,210,210]
        };

        function hashHue(text){ let h=0; for(let i=0;i<text.length;i++){ h=(h*31 + text.charCodeAt(i))>>>0; } return h%360; }
        function parseTimeSpan(s){ const m=s && s.match(/(\d+):(\d+)-(\d+):(\d+)/); if(!m) return null; const a=+m[1]*60+ +m[2]; const b=+m[3]*60+ +m[4]; return {start:a,end:b,dur:Math.max(1,b-a)}; }
        function parseScriptToScenes(txt){ const lines=txt.split(/\r?\n/); const out=[]; let cur=null; for(const line of lines){ const t=line.trim(); if(!t) continue; const m=t.match(/^\[SCENE[^\]]*-(.*?)\]/i); if(m){ const ts=parseTimeSpan(m[1]); cur={title:t.replace(/^\[|\]$/g,''), desc:'', ...(ts||{start:null,end:null,dur:null})}; out.push(cur); continue; }
                if(!cur){ cur={title:'Scene',desc:'',start:null,end:null,dur:null}; out.push(cur); }
                cur.desc += (cur.desc?"\n":"") + t; }
            // assign durations if missing
            const unknown = out.filter(s=>!s.dur);
            if(unknown.length){ const def=8; let acc=0; out.forEach(s=>{ if(!s.dur){ s.dur=def; s.start=acc; s.end=acc+def; acc+=def; }}); }
            return out; }

        function ensureCanvas(){ const vp=document.getElementById('videoPreview'); let cvs=vp.querySelector('canvas'); if(!cvs){ vp.innerHTML=''; cvs=document.createElement('canvas'); cvs.width=1280; cvs.height=720; cvs.style.width='100%'; cvs.style.border='1px solid rgba(255,255,255,0.15)'; cvs.style.borderRadius='10px'; vp.appendChild(cvs); } return cvs; }
        function pickPaletteHue(scene, palette){ const pal=PALETTES[palette]||PALETTES.vibrant; const base=pal[Math.floor((hashHue(scene.title+scene.desc))%pal.length)]; return (base + (hashHue(scene.desc)%40))%360; }
        function drawSceneFrame(ctx,w,h,scene,tIn,dur,hue){
            const zoom = 1 + 0.03*Math.sin((tIn/dur)*Math.PI*2);
            ctx.save(); ctx.translate(w/2,h/2); ctx.scale(zoom,zoom); ctx.translate(-w/2,-h/2);
            const grad=ctx.createRadialGradient(w/2,h/2,0,w/2,h/2,Math.max(w,h)*.7);
            grad.addColorStop(0,`hsl(${hue},70%,60%)`); grad.addColorStop(1,`hsl(${(hue+30)%360},70%,15%)`);
            ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);
            // particles
            ctx.globalCompositeOperation='lighter'; const n=40; for(let i=0;i<n;i++){ const ang=i/n*Math.PI*2 + tIn*.6; const r=120 + (i%10)*12 + 40*Math.sin(tIn*.8+i); const x=w/2+Math.cos(ang)*r; const y=h/2+Math.sin(ang)*r; const sz=4 + (i%7);
                ctx.fillStyle=`hsla(${(hue+i*7)%360},80%,70%,0.25)`; ctx.beginPath(); ctx.arc(x,y,sz,0,Math.PI*2); ctx.fill(); }
            ctx.globalCompositeOperation='source-over';
            // text cards
            ctx.fillStyle='rgba(0,0,0,0.35)'; ctx.fillRect(w*0.08,h*0.12,w*0.84,h*0.22); ctx.fillRect(w*0.08,h*0.72,w*0.84,h*0.18);
            ctx.strokeStyle=`hsla(${hue},100%,75%,0.6)`; ctx.lineWidth=3; ctx.strokeRect(w*0.08,h*0.12,w*0.84,h*0.22);
            ctx.font='700 40px Inter, Arial'; ctx.fillStyle='white'; ctx.textAlign='left'; ctx.fillText(scene.title.replace(/\[|\]/g,''), w*0.1, h*0.2);
            ctx.font='400 22px Inter, Arial'; const descLines=(scene.desc||'').split(/\n/).slice(0,4); let y=h*0.24; for(const L of descLines){ ctx.fillText(L, w*0.1, y); y+=28; }
            ctx.font='600 20px Inter, Arial'; ctx.fillStyle='rgba(255,255,255,0.85)'; ctx.textAlign='right';
            const st = scene.start!=null?scene.start:0; const en = scene.end!=null?scene.end:st+(scene.dur||8);
            ctx.fillText(`${formatTime(st)} - ${formatTime(en)}`, w*0.9, h*0.82);
            ctx.restore();
            // vignette
            const vg=ctx.createRadialGradient(w/2,h/2,Math.min(w,h)*.5,w/2,h/2,Math.max(w,h)*.8); vg.addColorStop(0,'rgba(0,0,0,0)'); vg.addColorStop(1,'rgba(0,0,0,0.35)'); ctx.fillStyle=vg; ctx.fillRect(0,0,w,h);
        }
        function formatTime(sec){ const m=Math.floor(sec/60), s=Math.floor(sec%60); return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }

        function startPreview(){ if(scriptPlayback.playing) cancelAnimationFrame(scriptPlayback.raf); const cvs=ensureCanvas(); const ctx=cvs.getContext('2d'); scriptPlayback.canvas=cvs; scriptPlayback.ctx=ctx; scriptPlayback.playing=true; scriptPlayback.startTime=performance.now() - (scriptPlayback.pauseOffset||0)*1000; const fps=scriptPlayback.fps; const total=scriptScenes.reduce((a,s)=>a+(s.dur||8),0); const totalFrames=Math.floor(total*fps);
            const hues=scriptScenes.map(s=>pickPaletteHue(s,scriptPlayback.palette));
            const step=()=>{ if(!scriptPlayback.playing) return; let t=(performance.now()-scriptPlayback.startTime)/1000; const loopOn = document.getElementById('loopEnable')?.checked; const loopIn = parseFloat(document.getElementById('loopIn')?.value||'0'); let loopOut = parseFloat(document.getElementById('loopOut')?.value||'0'); if(loopOut<=0) loopOut=total; if(loopOn){ if(t<loopIn) t=loopIn; if(t>=loopOut){ scriptPlayback.startTime = performance.now() - loopIn*1000; t=loopIn; } }
                const frame=Math.floor(t*fps); if(frame>=totalFrames){ scriptPlayback.playing=false; scriptPlayback.pauseOffset=0; updateSeekAndTimecode(total,total); return; }
                let acc=0, idx=0; for(let i=0;i<scriptScenes.length;i++){ const d=scriptScenes[i].dur||8; if(t<acc+d){ idx=i; break; } acc+=d; }
                const sc=scriptScenes[idx]; const localT=t - scriptScenes.slice(0,idx).reduce((a,s)=>a+(s.dur||8),0);
                ctx.clearRect(0,0,cvs.width,cvs.height); drawSceneFrame(ctx,cvs.width,cvs.height,sc,localT,sc.dur||8,hues[idx]);
                // update seek + timecode
                updateSeekAndTimecode(t,total);
                drawLyricsOverlay(ctx, cvs.width, cvs.height, t);
                scriptPlayback.raf=requestAnimationFrame(step);
            };
            scriptPlayback.raf=requestAnimationFrame(step);
        }
        function updateSeekAndTimecode(t,total){ const seek=document.getElementById('previewSeek'); if(seek){ seek.value = String((t/total)*100); } const tc=document.getElementById('timecode'); if(tc){ tc.textContent = `${formatTime(t)} / ${formatTime(total)}`; } }
        function togglePreviewPlay(){ const btn=document.getElementById('btnPlayPause'); const total=scriptScenes.reduce((a,s)=>a+(s.dur||8),0)||0; if(!scriptPlayback.playing){ startPreview(); if(btn) btn.textContent='‚è∏ Pause'; } else { scriptPlayback.playing=false; cancelAnimationFrame(scriptPlayback.raf); const t=(performance.now()-scriptPlayback.startTime)/1000; scriptPlayback.pauseOffset=t; if(btn) btn.textContent='‚ñ∂ Play'; updateSeekAndTimecode(t,total); } }
        function stopPreview(){ scriptPlayback.playing=false; cancelAnimationFrame(scriptPlayback.raf); scriptPlayback.pauseOffset=0; const btn=document.getElementById('btnPlayPause'); if(btn) btn.textContent='‚ñ∂ Play'; const total=scriptScenes.reduce((a,s)=>a+(s.dur||8),0)||0; updateSeekAndTimecode(0,total); const cvs=ensureCanvas(); const ctx=cvs.getContext('2d'); ctx.clearRect(0,0,cvs.width,cvs.height); }
        document.addEventListener('input', (e)=>{ if(e.target && e.target.id==='previewSeek'){ const total=scriptScenes.reduce((a,s)=>a+(s.dur||8),0)||1; const pct=parseFloat(e.target.value||'0')/100; const t=pct*total; scriptPlayback.pauseOffset=t; if(scriptPlayback.playing){ scriptPlayback.startTime = performance.now() - t*1000; } else { // render a single frame at t
                const cvs=ensureCanvas(); const ctx=cvs.getContext('2d'); let acc=0, idx=0; for(let i=0;i<scriptScenes.length;i++){ const d=scriptScenes[i].dur||8; if(t<acc+d){ idx=i; break; } acc+=d; } const sc=scriptScenes[idx]; const localT=t - scriptScenes.slice(0,idx).reduce((a,s)=>a+(s.dur||8),0); const hues=scriptScenes.map(s=>pickPaletteHue(s,scriptPlayback.palette)); ctx.clearRect(0,0,cvs.width,cvs.height); drawSceneFrame(ctx,cvs.width,cvs.height,sc,localT,sc.dur||8,hues[idx]); drawLyricsOverlay(ctx, cvs.width, cvs.height, t); }
                updateSeekAndTimecode(t,total);} });
        function formatTime(sec){ if(!isFinite(sec)) return '00:00.0'; const s=Math.max(0,sec); const m=Math.floor(s/60); const r=s-m*60; return `${String(m).padStart(2,'0')}:${r.toFixed(1).padStart(4,'0')}`; }

        async function startAudioIfAny(){ const inp=document.getElementById('scriptAudioInput'); if(!inp || !inp.files || !inp.files[0]) return; if(!scriptAudio.ctx) scriptAudio.ctx=new (window.AudioContext||window.webkitAudioContext)(); const ab=await inp.files[0].arrayBuffer(); scriptAudio.buf=await scriptAudio.ctx.decodeAudioData(ab.slice(0)); }

        function updateStage(progress, text, stage){ const fill=document.getElementById('progressFill'); const lbl=document.getElementById('progressText'); if(fill) fill.style.width = `${progress}%`; if(lbl) lbl.textContent=text; if(stage) updateStageIndicators(stage); }

        // üéõÔ∏è INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            initializeInterface();
        });

        function initializeInterface() {
            // Set default content
            updatePlaceholder();
        }

        // üìù SCRIPT TYPE SELECTION
        function selectScriptType(type, ev) {
            currentScriptType = type;
            
            // Update UI
            document.querySelectorAll('.script-type').forEach(el => el.classList.remove('active'));
            const src = ev && ev.target ? ev.target : (typeof event !== 'undefined' && event.target ? event.target : null);
            if (src) src.classList.add('active');
            
            updatePlaceholder();
        }

        function updatePlaceholder(kind) {
            const textarea = document.getElementById('scriptContent');
            const placeholders = {
                narrative: `Enter your narrative script here...

Example Format:
[SCENE 1 - 0:00-0:15]
LOCATION: Cozy coffee shop, morning light filtering through windows
CAMERA: Wide establishing shot, slow zoom to character
CHARACTER: Sarah, mid-30s, thoughtful expression
ACTION: Sarah sits alone, stirring coffee, lost in thought
DIALOGUE: "Sometimes the biggest decisions come in the quietest moments..."
MUSIC: Gentle piano, contemplative mood

[SCENE 2 - 0:15-0:30]
LOCATION: Same coffee shop, close-up on Sarah's hands
CAMERA: Macro shot, shallow depth of field
ACTION: Sarah's hands nervously fidget with a letter
DIALOGUE: (Voiceover) "The letter had been sitting on my desk for weeks..."
MUSIC: Building tension, subtle strings

[SCENE 3 - 0:30-0:45]
LOCATION: Flashback - Corporate office, bright fluorescent lighting
CAMERA: Medium shot, handheld for intimacy
CHARACTER: Sarah in business attire, confident posture
ACTION: Sarah presenting to a boardroom
DIALOGUE: "We need to think bigger, take risks..."
MUSIC: Corporate energy, uplifting

Continue with detailed scene descriptions...`,

                commercial: `Enter your commercial script here...

Example Format:
[SCENE 1 - 0:00-0:05]
LOCATION: Modern kitchen, bright natural lighting
CAMERA: Close-up product shot, rotating 360 degrees
PRODUCT: Revolutionary kitchen gadget on marble counter
ACTION: Product slowly rotates, highlighting key features
VOICEOVER: "Introducing the future of cooking..."
MUSIC: Upbeat, modern commercial jingle

[SCENE 2 - 0:05-0:15]
LOCATION: Same kitchen, family cooking together
CAMERA: Medium wide shot, warm and inviting
CHARACTERS: Happy family of four, diverse ages
ACTION: Family using product, laughing and enjoying
VOICEOVER: "Bringing families together, one meal at a time"
MUSIC: Heartwarming family theme

[SCENE 3 - 0:15-0:25]
LOCATION: Quick montage of different kitchens
CAMERA: Fast cuts, dynamic angles
ACTION: Various people using product successfully
VOICEOVER: "Join thousands of satisfied customers..."
MUSIC: Building excitement, testimonial energy

[SCENE 4 - 0:25-0:30]
LOCATION: Product close-up with pricing
CAMERA: Clean product shot, clear text overlay
ACTION: Product with call-to-action elements
VOICEOVER: "Order now and save 30%!"
MUSIC: Urgent call-to-action theme`,

                educational: `Enter your educational script here...

Example Format:
[SCENE 1 - 0:00-0:10]
LOCATION: Modern classroom/studio setup
CAMERA: Medium shot of instructor, professional lighting
INSTRUCTOR: Expert in field, approachable demeanor
ACTION: Instructor introduces topic with enthusiasm
DIALOGUE: "Today we're going to explore the fascinating world of..."
GRAPHICS: Title card with lesson topic
MUSIC: Inspiring educational theme

[SCENE 2 - 0:10-0:30]
LOCATION: Close-up of demonstration materials
CAMERA: Overhead shot, clear view of process
ACTION: Step-by-step demonstration begins
DIALOGUE: "Let's start with the fundamentals..."
GRAPHICS: Step numbers and key points overlay
MUSIC: Focused learning atmosphere

[SCENE 3 - 0:30-0:50]
LOCATION: Split screen showing results
CAMERA: Before/after comparison shots
ACTION: Showing transformation or results
DIALOGUE: "Notice how this technique transforms..."
GRAPHICS: Arrows, highlights, and annotations
MUSIC: Achievement and discovery theme

Continue with clear instructional progression...`,

                promotional: `Enter your promotional script here...

Example Format:
[SCENE 1 - 0:00-0:08]
LOCATION: Dynamic brand environment
CAMERA: Sweeping drone shot revealing logo/brand
BRAND: Your company/product prominently featured
ACTION: Brand reveal with energy and impact
VOICEOVER: "Experience the difference with [Brand Name]"
MUSIC: Brand anthem, powerful and memorable

[SCENE 2 - 0:08-0:20]
LOCATION: Customer testimonial settings
CAMERA: Intimate medium shots of real customers
CHARACTERS: Diverse, authentic customer base
ACTION: Customers sharing genuine experiences
DIALOGUE: "Since using [Product], my life has changed..."
MUSIC: Authentic, trust-building melody

[SCENE 3 - 0:20-0:35]
LOCATION: Product/service in action montage
CAMERA: Dynamic cuts showcasing versatility
ACTION: Multiple use cases and scenarios
VOICEOVER: "Whether you're [scenario 1] or [scenario 2]..."
MUSIC: Versatile, adaptable rhythm

[SCENE 4 - 0:35-0:45]
LOCATION: Strong call-to-action environment
CAMERA: Direct, engaging shot
ACTION: Clear next steps for audience
DIALOGUE: "Join thousands who've already made the switch"
MUSIC: Urgent, motivating finale`
            };
            
            const key = kind || currentScriptType || 'narrative';
            textarea.placeholder = placeholders[key] || placeholders.narrative;
        }

        // üìã TEMPLATE LOADING
        function loadTemplate(templateType) {
            const templates = {
                'product-demo': `[SCENE 1 - 0:00-0:05]
LOCATION: Clean product studio, white background
CAMERA: 360-degree product rotation
ACTION: Product showcase with elegant lighting
VOICEOVER: "Introducing the next generation..."

[SCENE 2 - 0:05-0:20]
LOCATION: Real-world usage environment
CAMERA: Over-shoulder perspective
ACTION: Person using product naturally
VOICEOVER: "See how easy it is..."

[SCENE 3 - 0:20-0:30]
LOCATION: Benefits demonstration
CAMERA: Split-screen before/after
ACTION: Problem vs solution comparison
VOICEOVER: "Get results in minutes, not hours"`,

                'testimonial': `[SCENE 1 - 0:00-0:10]
LOCATION: Customer's natural environment
CAMERA: Medium shot, warm natural lighting
CHARACTER: Real customer, authentic emotion
ACTION: Customer shares opening statement
DIALOGUE: "I was skeptical at first, but..."

[SCENE 2 - 0:10-0:25]
LOCATION: Same setting, slightly closer
CAMERA: Close-up for emotional connection
ACTION: Customer shares specific benefits
DIALOGUE: "The results exceeded my expectations..."

[SCENE 3 - 0:25-0:30]
LOCATION: Customer with product/service
CAMERA: Wide shot showing context
ACTION: Customer recommends to others
DIALOGUE: "I tell everyone about this..."`,

                'brand-story': `[SCENE 1 - 0:00-0:10]
LOCATION: Company origins setting
CAMERA: Nostalgic, documentary style
ACTION: Founding story introduction
VOICEOVER: "It all started with a simple idea..."

[SCENE 2 - 0:10-0:25]
LOCATION: Evolution timeline montage
CAMERA: Time-lapse and progression shots
ACTION: Growth and development journey
VOICEOVER: "Through challenges and triumphs..."

[SCENE 3 - 0:25-0:40]
LOCATION: Modern company environment
CAMERA: Proud, forward-looking shots
ACTION: Current success and team
VOICEOVER: "Today, we continue that mission..."`,

                'how-to': `[SCENE 1 - 0:00-0:05]
LOCATION: Clean instructional setup
CAMERA: Overview of materials/tools
ACTION: Introduction to what will be taught
DIALOGUE: "Today I'll show you how to..."

[SCENE 2 - 0:05-0:20]
LOCATION: Step-by-step demonstration area
CAMERA: Clear overhead and angle shots
ACTION: First steps of the process
DIALOGUE: "Start by gathering these materials..."

[SCENE 3 - 0:20-0:35]
LOCATION: Continued demonstration
CAMERA: Close-up detail shots
ACTION: Key technique demonstration
DIALOGUE: "The secret is in this technique..."

[SCENE 4 - 0:35-0:45]
LOCATION: Final result showcase
CAMERA: Proud reveal of finished result
ACTION: Showing completed project
DIALOGUE: "And there you have it!"`,

                'dramatic': `[SCENE 1 - 0:00-0:10]
LOCATION: Moody interior, dramatic lighting
CAMERA: Low angle, tension-building shot
CHARACTER: Protagonist in contemplation
ACTION: Character facing difficult decision
DIALOGUE: "There's no going back after this..."

[SCENE 2 - 0:10-0:25]
LOCATION: Contrasting environment
CAMERA: High tension, quick cuts
ACTION: Conflict or obstacle revealed
DIALOGUE: "You don't understand what's at stake"

[SCENE 3 - 0:25-0:40]
LOCATION: Climactic setting
CAMERA: Intense close-ups, dramatic angles
ACTION: Confrontation or revelation
DIALOGUE: "The truth changes everything..."`,

                'comedy': `[SCENE 1 - 0:00-0:08]
LOCATION: Everyday setting with comedic potential
CAMERA: Wide shot to establish normalcy
CHARACTER: Unsuspecting protagonist
ACTION: Normal activity about to go wrong
DIALOGUE: "What could possibly go wrong?"

[SCENE 2 - 0:08-0:20]
LOCATION: Same setting, chaos ensuing
CAMERA: Quick cuts, exaggerated angles
ACTION: Comedic mishap unfolds
DIALOGUE: "This wasn't in the instructions!"

[SCENE 3 - 0:20-0:30]
LOCATION: Aftermath of comedy
CAMERA: Wide shot revealing full mess
ACTION: Character dealing with consequences
DIALOGUE: "Next time, I'm hiring a professional"`
            };
            
            const scriptContent = document.getElementById('scriptContent');
            if (templates[templateType]) {
                scriptContent.value = templates[templateType];
                showToast(`üìã ${templateType.replace('-', ' ').toUpperCase()} template loaded!`, 'success');
            }
        }

        // üé® STYLE SELECTION
        function selectGenerationStyle(style, ev) {
            currentGenerationStyle = style;
            
            // Update UI
            document.querySelectorAll('.style-option').forEach(el => el.classList.remove('active'));
            const src = ev && ev.target ? ev.target : (typeof event !== 'undefined' && event.target ? event.target : null);
            if (src) src.classList.add('active');
        }

        // üöÄ VIDEO GENERATION
        function generateFromScript() {
            const scriptContent = document.getElementById('scriptContent').value.trim();
            if (!scriptContent) { setStatus('‚ö†Ô∏è Please enter a script first!', 'warn'); return; }
            const fpsSel=document.getElementById('scriptFps');
            const palSel=document.getElementById('scriptPalette');
            scriptPlayback.fps = fpsSel ? parseInt(fpsSel.value||'30') : 30;
            scriptPlayback.palette = palSel ? palSel.value : 'vibrant';
            scriptScenes = parseScriptToScenes(scriptContent);
            generateSceneListFromScript();
            document.getElementById('progressContainer').style.display = 'block';
            updateStage(20,'üß© Parsed script into scenes',1);
            startPreview();
            updateStage(100,'‚úÖ Preview ready. Use Export to record.',5);
            isGenerating = false;
            showToast('üé¨ Preview ready', 'success');
        }

        function simulateScriptGeneration() { /* removed: using real preview/export */ }

        function updateStageIndicators(activeStage) {
            for (let i = 1; i <= 5; i++) {
                const stage = document.getElementById(`stage${i}`);
                stage.classList.remove('active', 'completed');
                
                if (i < activeStage) {
                    stage.classList.add('completed');
                } else if (i === activeStage) {
                    stage.classList.add('active');
                }
            }
        }

        function onScriptGenerationComplete() { /* replaced by real pipeline */ }

        function generateSceneListFromScript() {
            const sceneList = document.getElementById('sceneList');
            sceneList.innerHTML = '';
            scriptScenes.forEach((scene, index) => {
                const st = scene.start!=null?scene.start:index*8;
                const en = scene.end!=null?scene.end:st+(scene.dur||8);
                const time=`${formatTime(st)}-${formatTime(en)}`;
                const sceneItem = document.createElement('div');
                sceneItem.className = 'scene-item';
                sceneItem.innerHTML = `
                    <div class="scene-preview">üé¨</div>
                    <div class="scene-info">
                        <div class="scene-time">${time}</div>
                        <div class="scene-description">${(scene.desc||'').split('\\n')[0]||scene.title}</div>
                        <div style="font-size: 10px; color: #BA55D3; margin-top: 2px;">Length: ${Math.round(scene.dur||8)}s</div>
                    </div>
                    <div class="scene-controls">
                        <button class="scene-btn" onclick="editScene(${index})">Edit</button>
                        <button class="scene-btn" onclick="regenerateScene(${index})">Regen</button>
                        <button class="scene-btn" onclick="deleteScene(${index})">Del</button>
                    </div>`;
                sceneList.appendChild(sceneItem);
            });
        }

        // üé¨ SCENE MANAGEMENT
        function editScene(sceneIndex) {
            const s=scriptScenes[sceneIndex]; if(!s) return; const newDesc=prompt('Edit scene description:', s.desc||''); if(newDesc===null) return; const durPrompt = prompt('Edit duration (seconds):', String(Math.round(s.dur||8)));
            const newDur=parseFloat(durPrompt);
            if(!isNaN(newDur) && newDur>0){ s.dur=newDur; let acc=0; scriptScenes.forEach(sc=>{ sc.start=acc; sc.end=acc+(sc.dur||8); acc=sc.end; }); }
            s.desc=newDesc; generateSceneListFromScript(); startPreview();
        }

        function regenerateScene(sceneIndex) {
            const s=scriptScenes[sceneIndex]; if(!s) return; s.title = s.title + ' '; generateSceneListFromScript(); startPreview();
        }

        function deleteScene(sceneIndex) {
            scriptScenes.splice(sceneIndex,1); let acc=0; scriptScenes.forEach(sc=>{ sc.start=acc; sc.end=acc+(sc.dur||8); acc=sc.end; }); generateSceneListFromScript(); startPreview();
        }

        function addScene() {
            const desc=prompt('New scene description:'); if(!desc) return; const dur=parseFloat(prompt('Duration (seconds):','8'))||8; const start=scriptScenes.reduce((a,s)=>a+(s.dur||8),0); scriptScenes.push({title:'[SCENE]',desc,start,end:start+dur,dur}); generateSceneListFromScript(); startPreview();
        }

        function reorderScenes() {
            const a=parseInt(prompt('Move from index (1-based):','1'))-1; const b=parseInt(prompt('Move to index (1-based):','1'))-1; if(isNaN(a)||isNaN(b)||a<0||b<0||a>=scriptScenes.length||b>=scriptScenes.length) return; const [itm]=scriptScenes.splice(a,1); scriptScenes.splice(b,0,itm); let acc=0; scriptScenes.forEach(sc=>{ sc.start=acc; sc.end=acc+(sc.dur||8); acc=sc.end; }); generateSceneListFromScript(); startPreview();
        }

        function adjustTiming() {
            let acc=0; for(const sc of scriptScenes){ const v=parseFloat(prompt(`Duration for scene starting at ${formatTime(acc)} (sec):`, String(Math.round(sc.dur||8)))); if(!isNaN(v)&&v>0) sc.dur=v; acc+=sc.dur||8; } acc=0; scriptScenes.forEach(sc=>{ sc.start=acc; sc.end=acc+(sc.dur||8); acc=sc.end; }); generateSceneListFromScript(); startPreview();
        }

        // üëÅÔ∏è PREVIEW & EXPORT
        function previewScript() {
            const scriptContent = document.getElementById('scriptContent').value.trim();
            if (!scriptContent) { setStatus('‚ö†Ô∏è Please enter a script first!', 'warn'); return; }
            const fpsSel=document.getElementById('scriptFps');
            const palSel=document.getElementById('scriptPalette');
            scriptPlayback.fps = fpsSel ? parseInt(fpsSel.value||'30') : 30;
            scriptPlayback.palette = palSel ? palSel.value : 'vibrant';
            scriptScenes = parseScriptToScenes(scriptContent); generateSceneListFromScript(); startPreview();
            showToast('üëÅÔ∏è Script previewed', 'info');
        }

        async function exportVideo() {
            if(!scriptScenes.length){ setStatus('‚ö†Ô∏è Generate a preview first.', 'warn'); return; }
            await startAudioIfAny();
            const cvs=ensureCanvas(); const stream=cvs.captureStream(scriptPlayback.fps||30);
            if(scriptAudio.ctx && scriptAudio.buf){ const dest=scriptAudio.ctx.createMediaStreamDestination();
                if(scriptAudio.src){ try{scriptAudio.src.stop();}catch(_){} }
                const src=scriptAudio.ctx.createBufferSource(); src.buffer=scriptAudio.buf; src.connect(scriptAudio.ctx.destination); src.connect(dest); scriptAudio.src=src; src.start();
                dest.stream.getAudioTracks().forEach(t=>stream.addTrack(t));
            }
            try {
                const chosenMime = (window.MediaRecorder && MediaRecorder.isTypeSupported && (
                    MediaRecorder.isTypeSupported('video/webm;codecs=vp9') ? 'video/webm;codecs=vp9' :
                    (MediaRecorder.isTypeSupported('video/webm;codecs=vp8') ? 'video/webm;codecs=vp8' : 'video/webm')
                )) || 'video/webm';
                const mr=new MediaRecorder(stream,{mimeType: chosenMime}); recorder.mr=mr; recorder.chunks=[]; recorder.recording=true;
                mr.ondataavailable=e=>{ if(e.data && e.data.size>0) recorder.chunks.push(e.data); };
                mr.onstop=()=>{ const blob=new Blob(recorder.chunks,{type:chosenMime.split(';')[0]||'video/webm'}); const url=URL.createObjectURL(blob); try{ if(recorder.downloadUrl) URL.revokeObjectURL(recorder.downloadUrl); }catch(_){} recorder.downloadUrl=url; recorder.recording=false; const vp=document.getElementById('videoPreview'); const link=document.createElement('a'); link.href=url; link.download='script-video.webm'; link.textContent='Download Video'; link.className='sota-button'; link.style.display='inline-block'; link.style.marginTop='10px'; vp.appendChild(link); updateStage(100,'‚úÖ Export complete',5); showToast('üíæ Export complete', 'success'); };
                mr.start();
            } catch(e) {
                console.error(e);
                setStatus('‚ùå Recording/export failed: '+(e&&e.message?e.message:e), 'error', true);
                return;
            }
            const fps=scriptPlayback.fps||30; const ctx=cvs.getContext('2d'); const total=scriptScenes.reduce((a,s)=>a+(s.dur||8),0); const totalFrames=Math.floor(total*fps);
            const hues=scriptScenes.map(s=>pickPaletteHue(s,scriptPlayback.palette));
            let frame=0; updateStage(0,'üé• Exporting‚Ä¶',5);
            const loop=()=>{ if(!recorder.recording) return; const t=frame/fps; if(frame>=totalFrames){ try{ recorder.mr && recorder.mr.stop(); }catch(_){} return; }
                let acc=0, idx=0; for(let i=0;i<scriptScenes.length;i++){ const d=scriptScenes[i].dur||8; if(t<acc+d){ idx=i; break; } acc+=d; }
                const sc=scriptScenes[idx]; const localT=t - scriptScenes.slice(0,idx).reduce((a,s)=>a+(s.dur||8),0);
                ctx.clearRect(0,0,cvs.width,cvs.height); drawSceneFrame(ctx,cvs.width,cvs.height,sc,localT,sc.dur||8,hues[idx]);
                drawLyricsOverlay(ctx, cvs.width, cvs.height, t);
                frame++; if(frame%Math.max(1,Math.floor(totalFrames/100))===0) updateStage(Math.floor((frame/totalFrames)*100),'üé• Exporting‚Ä¶',5);
                setTimeout(()=>requestAnimationFrame(loop), 0);
            };
            requestAnimationFrame(loop);
        }

        // ===== Lyrics parsing and overlay =====
        document.addEventListener('change', (e)=>{
            if(e.target && e.target.id === 'lyricsFile' && e.target.files && e.target.files[0]){
                const file=e.target.files[0];
                const ext=(file.name.split('.').pop()||'').toLowerCase();
                const reader=new FileReader();
                reader.onload=()=>{ const text=String(reader.result||'');
                    if(ext==='lrc') lyrics = parseLRC(text);
                    else if(ext==='srt') lyrics = parseSRT(text);
                    else lyrics = parsePlainLyrics(text);
                    normalizeLyricDurations();
                    startPreview();
                };
                reader.readAsText(file);
            }
            if(e.target && e.target.id==='lyricsEnabled'){ lyricsSettings.enabled = (typeof e.target.checked === 'boolean') ? !!e.target.checked : (e.target.value==='on' || e.target.value==='true' || e.target.value==='1'); }
            if(e.target && e.target.id==='lyricsSize'){ lyricsSettings.size = parseInt(e.target.value||'36'); }
            if(e.target && e.target.id==='lyricsStyle'){ lyricsSettings.style = e.target.value||'karaoke'; }
        });

        function normalizeLyricDurations(){
            if(!lyrics || !lyrics.length) return; for(let i=0;i<lyrics.length;i++){ const cur=lyrics[i]; const nxt=lyrics[i+1]; if(cur.end==null){ cur.end = nxt? Math.max(cur.start+0.8, Math.min(nxt.start-0.1, cur.start+5)) : cur.start+3; } }
        }

        function parseTimeStr(str){
            const s=str.trim();
            let m = s.match(/^(\d+):(\d{2})(?:[\.:](\d{1,3}))?$/); // mm:ss.xx
            if(m){ const mm=+m[1], ss=+m[2], ms=m[3]? +m[3] : 0; return mm*60+ss+(ms>=100?ms/1000:ms/100); }
            m = s.match(/^(\d+):(\d{2}):(\d{2})(?:[\.,](\d{1,3}))?$/); // hh:mm:ss,ms
            if(m){ const hh=+m[1], mm=+m[2], ss=+m[3], ms=m[4]? +m[4] : 0; return hh*3600+mm*60+ss+ms/1000; }
            return NaN;
        }

        function parseLRC(text){
            const out=[]; const lines=text.split(/\r?\n/);
            for(const line of lines){ const tags=[...line.matchAll(/\[(\d{1,2}:\d{2}(?:[\.:]\d{1,3})?)\]/g)]; if(!tags.length) continue; const content=line.replace(/\[[^\]]+\]/g,'').trim(); for(const t of tags){ const ts=parseTimeStr(t[1]); if(!isNaN(ts)) out.push({start:ts, end:null, text:content}); } }
            out.sort((a,b)=>a.start-b.start); return out;
        }
        function parseSRT(text){
            const out=[]; const blocks=text.split(/\r?\n\r?\n/); const timeRe=new RegExp("(\\d+:\\d{2}:\\d{2}[\\.,]\\d{1,3})\\s*-->\\s*(\\d+:\\d{2}:\\d{2}[\\.,]\\d{1,3})");
            for(const b of blocks){ const lines=b.split(/\r?\n/).filter(Boolean); if(lines.length<2) continue; const m=lines[1].match(timeRe); if(!m) continue; const st=parseTimeStr(m[1]); const en=parseTimeStr(m[2]); const txt=lines.slice(2).join(' ').trim(); if(!isNaN(st)&&!isNaN(en)&&txt) out.push({start:st,end:en,text:txt}); }
            out.sort((a,b)=>a.start-b.start); return out;
        }
        function parsePlainLyrics(text){
            const lines=text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean); if(!lines.length) return [];
            const total=scriptScenes.reduce((a,s)=>a+(s.dur||8),0)||lines.length*3; const per=total/lines.length; const out=[]; for(let i=0;i<lines.length;i++){ const st=i*per; out.push({start:st, end:st+Math.max(2, per*0.9), text:lines[i]}); }
            return out;
        }

        function drawLyricsOverlay(ctx,w,h,t){ if(!lyricsSettings.enabled || !lyrics || !lyrics.length) return; const cur=lyrics.find((l,idx)=> t>=l.start && t<(l.end ?? (lyrics[idx+1]?lyrics[idx+1].start:l.start+3)) ); if(!cur) return; const start=cur.start; const end=cur.end ?? (start+3); const prog=Math.max(0, Math.min(1, (t-start)/Math.max(0.25,end-start)));
            const size=lyricsSettings.size||36; ctx.save(); ctx.textAlign='center'; ctx.textBaseline='middle';
            const y=h*0.85; ctx.font=`700 ${size}px Inter, Arial`;
            // backdrop box
            ctx.fillStyle='rgba(0,0,0,0.35)'; const pad=16; const met=ctx.measureText(cur.text); const bw=met.width+pad*2; const bh=size*1.6; ctx.fillRect((w-bw)/2, y-bh/2, bw, bh);
            // base text and karaoke overlay
            if(lyricsSettings.style==='plain'){
                ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.fillText(cur.text, w/2, y);
            } else {
                ctx.fillStyle='rgba(255,255,255,0.4)'; ctx.fillText(cur.text, w/2, y);
                const tx = w/2 - met.width/2; const clipW = met.width*prog; ctx.save(); ctx.beginPath(); ctx.rect(tx, y-size*0.55, clipW, size*1.1); ctx.clip(); ctx.fillStyle='hsl(48,100%,60%)'; ctx.fillText(cur.text, w/2, y); ctx.restore();
                ctx.lineWidth=3; ctx.strokeStyle='rgba(0,0,0,0.6)'; ctx.strokeText(cur.text, w/2, y);
            }
            ctx.restore(); }

        // üíæ PROJECT MANAGEMENT
        function saveScript() {
            const scriptContent = document.getElementById('scriptContent').value.trim();
            
            if (!scriptContent) { setStatus('‚ö†Ô∏è No script content to save!', 'warn'); return; }
            try { localStorage.setItem('sota:script:last', scriptContent); showToast('üíæ Script saved locally', 'success'); }
            catch(_) { setStatus('Could not save script to localStorage', 'error'); }
        }

        function loadScript() { const v = localStorage.getItem('sota:script:last'); if(v){ document.getElementById('scriptContent').value = v; showToast('üìÅ Loaded last saved script', 'info'); } else { setStatus('No saved script found', 'warn'); } }

        function shareProject() {
            const cvs = ensureCanvas(); if(!cvs){ setStatus('Generate a preview before sharing.', 'warn'); return; }
            const url = cvs.toDataURL('image/png');
            const box = document.createElement('div'); box.style.position='fixed'; box.style.right='20px'; box.style.bottom='20px'; box.style.zIndex='1600';
            const a = document.createElement('a'); a.href=url; a.download='preview.png'; a.textContent='Download Preview Image'; a.className='sota-button';
            box.appendChild(a); document.body.appendChild(box); showToast('üì§ Share: preview image ready to download', 'info'); setTimeout(()=>box.remove(), 6000);
        }

        // üöÄ STARTUP ANIMATION
        window.addEventListener('load', () => {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 1s ease';
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
        <script src="./composer-shim.js"></script>
</body>
</html>